# API错误码文档

## 概述

本文档详细说明了电商系统API可能返回的错误码、错误信息以及相应的处理建议。

## 错误响应格式

所有API错误响应都遵循统一的格式：

```json
{
  "code": 错误码,
  "message": "错误描述信息",
  "data": null
}
```

## 系统级错误码 (1000-1999)

### 1000 - 系统错误
- **描述**: 系统内部发生未知错误
- **HTTP状态码**: 500
- **处理建议**: 稍后重试，如果问题持续存在请联系技术支持
- **示例**:
```json
{
  "code": 1000,
  "message": "系统内部错误",
  "data": null
}
```

### 1001 - 数据访问失败
- **描述**: 数据库操作失败
- **HTTP状态码**: 500
- **处理建议**: 检查数据库连接状态，稍后重试
- **示例**:
```json
{
  "code": 1001,
  "message": "数据访问失败",
  "data": null
}
```

### 1002 - Redis连接失败
- **描述**: Redis缓存服务连接失败
- **HTTP状态码**: 500
- **处理建议**: 检查Redis服务状态，系统会降级到数据库查询
- **示例**:
```json
{
  "code": 1002,
  "message": "缓存服务不可用",
  "data": null
}
```

## 参数错误码 (2000-2999)

### 2000 - 参数错误
- **描述**: 请求参数不符合要求
- **HTTP状态码**: 400
- **处理建议**: 检查请求参数的格式、类型和取值范围
- **示例**:
```json
{
  "code": 2000,
  "message": "参数错误：商品ID不能为空",
  "data": null
}
```

### 2001 - 参数验证失败
- **描述**: 请求参数未通过验证规则
- **HTTP状态码**: 400
- **处理建议**: 根据具体的验证错误信息调整参数值
- **常见验证错误**:
  - 商品名称不能为空
  - 商品价格必须大于0
  - 库存数量不能为负数
  - 邮箱格式不正确
  - 手机号格式不正确
- **示例**:
```json
{
  "code": 2001,
  "message": "商品名称不能为空",
  "data": null
}
```

### 2002 - 分页参数错误
- **描述**: 分页参数不合法
- **HTTP状态码**: 400
- **处理建议**: 确保pageNum >= 1, pageSize在1-100之间
- **示例**:
```json
{
  "code": 2002,
  "message": "页码必须大于0",
  "data": null
}
```

## 业务错误码 (3000-3999)

### 商品相关错误码 (3000-3099)

#### 3000 - 商品不存在
- **描述**: 指定的商品ID不存在
- **HTTP状态码**: 404
- **处理建议**: 检查商品ID是否正确，或者商品是否已被删除
- **示例**:
```json
{
  "code": 3000,
  "message": "商品不存在",
  "data": null
}
```

#### 3001 - 商品已存在
- **描述**: 尝试创建重复的商品
- **HTTP状态码**: 409
- **处理建议**: 检查商品名称或SKU是否重复
- **示例**:
```json
{
  "code": 3001,
  "message": "商品名称已存在",
  "data": null
}
```

#### 3002 - 商品库存不足
- **描述**: 商品库存数量不足以满足请求
- **HTTP状态码**: 400
- **处理建议**: 减少购买数量或选择其他商品
- **示例**:
```json
{
  "code": 3002,
  "message": "商品库存不足，当前库存：5",
  "data": null
}
```

#### 3003 - 商品已下架
- **描述**: 商品当前处于下架状态，不可购买
- **HTTP状态码**: 400
- **处理建议**: 选择其他在售商品
- **示例**:
```json
{
  "code": 3003,
  "message": "商品已下架，暂不可购买",
  "data": null
}
```

#### 3004 - 商品价格无效
- **描述**: 商品价格设置不合理
- **HTTP状态码**: 400
- **处理建议**: 确保价格大于0且不超过最大限制
- **示例**:
```json
{
  "code": 3004,
  "message": "商品价格必须大于0",
  "data": null
}
```

### 用户相关错误码 (3100-3199)

#### 3100 - 用户不存在
- **描述**: 指定的用户不存在
- **HTTP状态码**: 404
- **处理建议**: 检查用户ID或用户名是否正确
- **示例**:
```json
{
  "code": 3100,
  "message": "用户不存在",
  "data": null
}
```

#### 3101 - 用户未登录
- **描述**: 需要登录才能访问的接口
- **HTTP状态码**: 401
- **处理建议**: 先进行用户登录
- **示例**:
```json
{
  "code": 3101,
  "message": "用户未登录",
  "data": null
}
```

#### 3102 - 权限不足
- **描述**: 用户没有执行该操作的权限
- **HTTP状态码**: 403
- **处理建议**: 联系管理员获取相应权限
- **示例**:
```json
{
  "code": 3102,
  "message": "权限不足",
  "data": null
}
```

### 订单相关错误码 (3200-3299)

#### 3200 - 订单不存在
- **描述**: 指定的订单不存在
- **HTTP状态码**: 404
- **处理建议**: 检查订单号是否正确
- **示例**:
```json
{
  "code": 3200,
  "message": "订单不存在",
  "data": null
}
```

#### 3201 - 订单状态错误
- **描述**: 订单当前状态不允许执行该操作
- **HTTP状态码**: 400
- **处理建议**: 检查订单状态是否符合操作要求
- **示例**:
```json
{
  "code": 3201,
  "message": "订单已完成，无法取消",
  "data": null
}
```

## 外部服务错误码 (4000-4999)

### 4000 - 第三方服务不可用
- **描述**: 依赖的第三方服务暂时不可用
- **HTTP状态码**: 503
- **处理建议**: 稍后重试
- **示例**:
```json
{
  "code": 4000,
  "message": "支付服务暂时不可用",
  "data": null
}
```

### 4001 - 支付失败
- **描述**: 支付处理失败
- **HTTP状态码**: 400
- **处理建议**: 检查支付信息或更换支付方式
- **示例**:
```json
{
  "code": 4001,
  "message": "支付失败：余额不足",
  "data": null
}
```

## 错误处理最佳实践

### 客户端处理建议

1. **统一错误处理**: 建议在客户端实现统一的错误处理机制
2. **用户友好提示**: 将技术错误码转换为用户友好的提示信息
3. **重试机制**: 对于临时性错误（如网络错误），实现自动重试
4. **日志记录**: 记录错误信息用于问题排查

### 错误码使用规范

1. **错误码分类**: 按照错误类型进行分类，便于快速定位问题
2. **错误信息**: 提供清晰、具体的错误描述
3. **HTTP状态码**: 正确设置HTTP状态码，与错误类型保持一致
4. **国际化**: 支持多语言错误信息

### 示例代码

#### JavaScript错误处理
```javascript
function handleApiError(error) {
  const { code, message } = error.response.data;
  
  switch (code) {
    case 3000:
      showMessage('商品不存在，请刷新页面重试');
      break;
    case 3002:
      showMessage('库存不足，请减少购买数量');
      break;
    case 1000:
      showMessage('系统繁忙，请稍后重试');
      setTimeout(() => retryRequest(), 3000);
      break;
    default:
      showMessage(message || '操作失败，请重试');
  }
}
```

#### Java错误处理
```java
@ControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<Result> handleBusinessException(BusinessException e) {
        log.error("业务异常: {}", e.getMessage());
        return ResponseEntity
            .status(e.getErrorCode().getHttpStatus())
            .body(Result.error(e.getErrorCode(), e.getMessage()));
    }
}
```

## 常见问题排查

### Q: 如何快速定位错误原因？
A: 根据错误码的分类快速定位：
- 1xxx: 系统问题，检查服务状态
- 2xxx: 参数问题，检查请求参数
- 3xxx: 业务问题，检查业务逻辑
- 4xxx: 外部服务问题，检查第三方服务

### Q: 遇到系统错误如何处理？
A: 
1. 记录错误详情和请求参数
2. 稍后重试
3. 如果问题持续，联系技术支持

### Q: 如何避免参数验证错误？
A:
1. 仔细阅读API文档中的参数说明
2. 在客户端进行参数预验证
3. 使用API测试工具验证参数格式

## 更新日志

- **v1.0.0** (2024-01-01): 初始版本，包含基础错误码定义
- **v1.1.0** (2024-01-15): 新增商品相关错误码
- **v1.2.0** (2024-02-01): 新增用户和订单相关错误码
- **v1.3.0** (2024-02-15): 新增外部服务错误码和处理建议